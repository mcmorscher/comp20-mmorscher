<!DOCTYPE html>

<html>

<head>
    <meta charset="utf-8" />
    <title>Captain's Log</title>
    <link rel="stylesheet" href="style.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script>
        var dayOfWeek = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
        var monthOfYear = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", 
                           "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
        
        //Return formatted timestamp
        function getTimestamp() {
            var currentDate = new Date();
            return  dayOfWeek[currentDate.getDay()] + " " + 
                    monthOfYear[currentDate.getMonth()] + " " + 
                    currentDate.getDate() + " " +
                    currentDate.getHours() + ":" +
                    currentDate.getMinutes() + ":" +
                    currentDate.getSeconds() + " " +
                    currentDate.getFullYear() + " - ";
        }
        
        //Get messages from local storage and display in reverse order
        function loadMessages() {
            var messageKeys = Object.keys(localStorage);
            for(key of messageKeys){
                var message = key + localStorage.getItem(key);
                var previous = $("#log")[0].innerHTML
                $("#log")[0].innerHTML = "<p>" + message + "</p>" + previous;
            }
        }
        
        //Update display when a new entry is made
        function reloadMessages(){
            $("#log")[0].innerHTML = "";
            loadMessages();
        }
        
        //Display messages and listen for new messages when page is loaded
        $(document).ready(function(){
            loadMessages();
            
            $("#msg")[0].onkeypress = function(e) {
                if(e.keyCode == 13) { //When user presses enter
                    //Store text locally and clear the input field
                    localStorage.setItem(getTimestamp(), $("#msg")[0].value);
                    $("#msg")[0].value = "";
                    reloadMessages();
                }
            };
        });
    </script>
</head>

<body>
    <h1>Captain's Log</h1>
    <h3>New entry: <input type="text" id="msg" name="msg" size="30" /></h3>
    <div id="log"></div>
</body>
</html>